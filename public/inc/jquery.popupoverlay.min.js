!function(u){var f,h,b=u(window),i={},v=[],g=[],m=null,r="_open",y="_close",_=[],k=null,c=/(iPad|iPhone|iPod)/g.test(navigator.userAgent),w={_init:function(t){var o=u(t),e=o.data("popupoptions");g[t.id]=!1,v[t.id]=0,o.data("popup-initialized")||(o.attr("data-popup-initialized","true"),w._initonce(t)),e.autoopen&&setTimeout(function(){w.show(t,0)},0)},_initonce:function(e){var t,o,i,n,a=u(e),s=u("body"),p=a.data("popupoptions");(m=parseInt(s.css("margin-right"),10),k=void 0!==document.body.style.webkitTransition||void 0!==document.body.style.MozTransition||void 0!==document.body.style.msTransition||void 0!==document.body.style.OTransition||void 0!==document.body.style.transition,"tooltip"==p.type&&(p.background=!1,p.scrolllock=!1),p.backgroundactive&&(p.background=!1,p.blur=!1,p.scrolllock=!1),p.scrolllock)&&(void 0===f&&(n=(i=u('<div style="width:50px;height:50px;overflow:auto"><div/></div>').appendTo("body")).children(),f=n.innerWidth()-n.height(99).innerWidth(),i.remove()));if(a.attr("id")||a.attr("id","j-popup-"+parseInt(1e8*Math.random(),10)),a.addClass("popup_content"),p.background&&!u("#"+e.id+"_background").length){s.append('<div id="'+e.id+'_background" class="popup_background"></div>');var d=u("#"+e.id+"_background");d.css({opacity:0,visibility:"hidden",backgroundColor:p.color,position:"fixed",top:0,right:0,bottom:0,left:0}),p.setzindex&&!p.autozindex&&d.css("z-index","100000"),p.transition&&d.css("transition",p.transition)}s.append(e),a.wrap('<div id="'+e.id+'_wrapper" class="popup_wrapper" />'),(t=u("#"+e.id+"_wrapper")).css({opacity:0,visibility:"hidden",position:"absolute"}),c&&t.css("cursor","pointer"),"overlay"==p.type&&t.css("overflow","auto"),a.css({opacity:0,visibility:"hidden",display:"inline-block"}),p.setzindex&&!p.autozindex&&t.css("z-index","100001"),p.outline||a.css("outline","none"),p.transition&&(a.css("transition",p.transition),t.css("transition",p.transition)),a.attr("aria-hidden",!0),"overlay"==p.type&&(a.css({textAlign:"left",position:"relative",verticalAlign:"middle"}),o={position:"fixed",width:"100%",height:"100%",top:0,left:0,textAlign:"center"},p.backgroundactive&&(o.position="absolute",o.height="0",o.overflow="visible"),t.css(o),t.append('<div class="popup_align" />'),u(".popup_align").css({display:"inline-block",verticalAlign:"middle",height:"100%"})),a.attr("role","dialog");var l=p.openelement?p.openelement:"."+e.id+r;u(l).each(function(t,o){u(o).attr("data-popup-ordinal",t),o.id||u(o).attr("id","open_"+parseInt(1e8*Math.random(),10))}),a.attr("aria-labelledby")||a.attr("aria-label")||a.attr("aria-labelledby",u(l).attr("id")),"hover"==p.action?(p.keepfocus=!1,u(l).on("mouseenter",function(t){w.show(e,u(this).data("popup-ordinal"))}),u(l).on("mouseleave",function(t){w.hide(e)})):u(document).on("click",l,function(t){t.preventDefault();var o=u(this).data("popup-ordinal");setTimeout(function(){w.show(e,o)},0)}),p.closebutton&&w.addclosebutton(e),p.detach?a.hide().detach():t.hide()},show:function(t,o){this.loaderAnimation=u(".loader").css("animation"),this.loaderTransform=u(".loader").css("transform"),u(".loader").css("animation","none"),u(".loader").css("transform","none");var e=u(t);if(!e.data("popup-visible")){e.data("popup-initialized")||w._init(t),e.attr("data-popup-initialized","true");var i=u("body"),n=e.data("popupoptions"),a=u("#"+t.id+"_wrapper"),s=u("#"+t.id+"_background");if(z(t,o,n.beforeopen),g[t.id]=o,setTimeout(function(){_.push(t.id)},0),n.autozindex){for(var p=document.getElementsByTagName("*"),d=p.length,l=0,r=0;r<d;r++){var c=u(p[r]).css("z-index");"auto"!==c&&l<(c=parseInt(c,10))&&(l=c)}v[t.id]=l,n.background&&0<v[t.id]&&u("#"+t.id+"_background").css({zIndex:v[t.id]+1}),0<v[t.id]&&a.css({zIndex:v[t.id]+2})}n.detach?(a.prepend(t),e.show()):a.show(),h=setTimeout(function(){a.css({visibility:"visible",opacity:1}),u("html").addClass("popup_visible").addClass("popup_visible_"+t.id),a.addClass("popup_wrapper_visible")},20),n.scrolllock&&(i.css("overflow","hidden"),i.height()>b.height()&&i.css("margin-right",m+f)),n.backgroundactive&&e.css({top:(b.height()-(e.get(0).offsetHeight+parseInt(e.css("margin-top"),10)+parseInt(e.css("margin-bottom"),10)))/2+"px"}),e.css({visibility:"visible",opacity:1}),n.background&&(s.css({visibility:"visible",opacity:n.opacity}),setTimeout(function(){s.css({opacity:n.opacity})},0)),e.data("popup-visible",!0),w.reposition(t,o),e.data("focusedelementbeforepopup",document.activeElement),n.keepfocus&&(e.attr("tabindex",-1),setTimeout(function(){"closebutton"===n.focuselement?u("#"+t.id+" ."+t.id+y+":first").focus():n.focuselement?u(n.focuselement).focus():e.focus()},n.focusdelay)),u(n.pagecontainer).attr("aria-hidden",!0),e.attr("aria-hidden",!1),z(t,o,n.onopen),k?a.one("transitionend",function(){z(t,o,n.opentransitionend)}):z(t,o,n.opentransitionend),"tooltip"==n.type&&u(window).on("resize."+t.id,function(){w.reposition(t,o)})}},hide:function(o,t){u(".loader").css("animation",this.loaderAnimation),u(".loader").css("transform",this.loaderTransform);var e=u.inArray(o.id,_);if(-1!==e){h&&clearTimeout(h);var i=u("body"),n=u(o),a=n.data("popupoptions"),s=u("#"+o.id+"_wrapper"),p=u("#"+o.id+"_background");n.data("popup-visible",!1),1===_.length?u("html").removeClass("popup_visible").removeClass("popup_visible_"+o.id):u("html").hasClass("popup_visible_"+o.id)&&u("html").removeClass("popup_visible_"+o.id),_.splice(e,1),s.hasClass("popup_wrapper_visible")&&s.removeClass("popup_wrapper_visible"),a.keepfocus&&!t&&setTimeout(function(){u(n.data("focusedelementbeforepopup")).is(":visible")&&n.data("focusedelementbeforepopup").focus()},0),s.css({visibility:"hidden",opacity:0}),n.css({visibility:"hidden",opacity:0}),a.background&&p.css({visibility:"hidden",opacity:0}),u(a.pagecontainer).attr("aria-hidden",!1),n.attr("aria-hidden",!0),z(o,g[o.id],a.onclose),k&&"0s"!==n.css("transition-duration")?n.one("transitionend",function(t){n.data("popup-visible")||(a.detach?n.hide().detach():s.hide()),a.scrolllock&&setTimeout(function(){i.css({overflow:"visible","margin-right":m})},10),z(o,g[o.id],a.closetransitionend)}):(a.detach?n.hide().detach():s.hide(),a.scrolllock&&setTimeout(function(){i.css({overflow:"visible","margin-right":m})},10),z(o,g[o.id],a.closetransitionend)),"tooltip"==a.type&&u(window).off("resize."+o.id)}},toggle:function(t,o){u(t).data("popup-visible")?w.hide(t):setTimeout(function(){w.show(t,o)},0)},reposition:function(t,o){var e=u(t),i=e.data("popupoptions"),n=u("#"+t.id+"_wrapper");u("#"+t.id+"_background");if(o=o||0,"tooltip"==i.type){var a;n.css({position:"absolute"});var s=(a=i.tooltipanchor?u(i.tooltipanchor):i.openelement?u(i.openelement).filter('[data-popup-ordinal="'+o+'"]'):u("."+t.id+r+'[data-popup-ordinal="'+o+'"]')).offset();"right"==i.horizontal?n.css("left",s.left+a.outerWidth()+i.offsetleft):"leftedge"==i.horizontal?n.css("left",s.left+a.outerWidth()-a.outerWidth()+i.offsetleft):"left"==i.horizontal?n.css("right",b.width()-s.left-i.offsetleft):"rightedge"==i.horizontal?n.css("right",b.width()-s.left-a.outerWidth()-i.offsetleft):n.css("left",s.left+a.outerWidth()/2-e.outerWidth()/2-parseFloat(e.css("marginLeft"))+i.offsetleft),"bottom"==i.vertical?n.css("top",s.top+a.outerHeight()+i.offsettop):"bottomedge"==i.vertical?n.css("top",s.top+a.outerHeight()-e.outerHeight()+i.offsettop):"top"==i.vertical?n.css("bottom",b.height()-s.top-i.offsettop):"topedge"==i.vertical?n.css("bottom",b.height()-s.top-e.outerHeight()-i.offsettop):n.css("top",s.top+a.outerHeight()/2-e.outerHeight()/2-parseFloat(e.css("marginTop"))+i.offsettop)}else"overlay"==i.type&&(i.horizontal?n.css("text-align",i.horizontal):n.css("text-align","center"),i.vertical?e.css("vertical-align",i.vertical):e.css("vertical-align","middle"))},addclosebutton:function(t){var o;o=u(t).data("popupoptions").closebuttonmarkup?u(i.closebuttonmarkup).addClass(t.id+"_close"):'<button class="popup_close '+t.id+'_close" title="Close" aria-label="Close"><span aria-hidden="true">Ã—</span></button>',u(t).data("popup-initialized")&&u(t).append(o)}},z=function(t,o,e){var i,n,a=u(t).data("popupoptions");void 0!==a&&(i=a.openelement?a.openelement:"."+t.id+r,n=u(i+'[data-popup-ordinal="'+o+'"]'),"function"==typeof e&&e.call(u(t),t,n))};u(document).on("keydown",function(t){if(_.length){var o=_[_.length-1],e=document.getElementById(o);u(e).data("popupoptions").escape&&27==t.keyCode&&w.hide(e)}}),u(document).on("click",function(t){if(_.length){var o=_[_.length-1],e=document.getElementById(o),i=u(e).data("popupoptions").closeelement?u(e).data("popupoptions").closeelement:"."+e.id+y;u(t.target).closest(i).length&&(t.preventDefault(),w.hide(e)),u(e).data("popupoptions")&&u(e).data("popupoptions").blur&&!u(t.target).closest("#"+o).length&&2!==t.which&&u(t.target).is(":visible")&&(u(e).data("popupoptions").background?(w.hide(e),t.preventDefault()):w.hide(e,!0))}}),u(document).on("keydown",function(t){if(_.length&&9==t.which){var o=_[_.length-1],e=document.getElementById(o),i=u(e).find("*").filter("a[href], area[href], input:not([disabled]), select:not([disabled]), textarea:not([disabled]), button:not([disabled]), iframe, object, embed, *[tabindex], *[contenteditable]").filter(":visible"),n=u(":focus"),a=i.length,s=i.index(n);0===a?(u(e).focus(),t.preventDefault()):t.shiftKey?0===s&&(i.get(a-1).focus(),t.preventDefault()):s==a-1&&(i.get(0).focus(),t.preventDefault())}}),u.fn.popup=function(e){return this.each(function(){var t=u(this);if("object"==typeof e){var o=u.extend({},u.fn.popup.defaults,t.data("popupoptions"),e);t.data("popupoptions",o),i=t.data("popupoptions"),w._init(this)}else"string"==typeof e?(t.data("popupoptions")||(t.data("popupoptions",u.fn.popup.defaults),i=t.data("popupoptions")),w[e].call(this,this)):(t.data("popupoptions")||(t.data("popupoptions",u.fn.popup.defaults),i=t.data("popupoptions")),w._init(this))})},u.fn.popup.defaults={type:"overlay",autoopen:!1,background:!0,backgroundactive:!1,color:"black",opacity:"0.5",horizontal:"center",vertical:"middle",offsettop:0,offsetleft:0,escape:!0,blur:!0,setzindex:!0,autozindex:!1,scrolllock:!1,closebutton:!1,closebuttonmarkup:null,keepfocus:!0,focuselement:null,focusdelay:50,outline:!1,pagecontainer:null,detach:!1,openelement:null,closeelement:null,transition:null,tooltipanchor:null,beforeopen:null,onclose:null,onopen:null,opentransitionend:null,closetransitionend:null}}(jQuery);
